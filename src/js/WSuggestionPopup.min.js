WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WSuggestionPopup",(function(e,t,n,i,l,s,o,r,c){t.wtObj=this;const u=this,f=e.WT;let d=null,a=null,g=!1,h=null,p=null,y=s,C=null,v=null,k=!1,T=!1,m=!1;this.defaultValue=o;function L(){return"object"==typeof f.theme&&"bootstrap"===f.theme.type&&5===f.theme.version}function E(e){return e.classList.contains("Wt-suggest-onedit")||e.classList.contains("Wt-suggest-dropdown")}u.setAdjust=function(e,t){T=e;m=t};function w(){return"none"!==t.style.display}function b(i){const l=i.firstChild.firstChild,s=f.getElement(a),o=l.innerHTML,r=l.getAttribute("sug");s.focus();n(s,o,r);e.emit(t,"select",i.id,s.id);x();a=null}let S=null;this.showPopup=function(e){t.style.display="block";u.bringToFront();d=null;v=null;S=e.onkeydown;e.onkeydown=function(e){const t=e||window.event;u.editKeyDown(this,t)}};this.bringToFront=function(){const e=f.maxZIndex();if(e>t.style.zIndex){const n=e+1;t.style.zIndex=n}};function x(){t.style.display="none";if(null!==a&&null!==S){f.getElement(a).onkeydown=S;S=null}}function W(e){if(!L())return 16;try{const t=getComputedStyle(e),n=parseInt(t.backgroundSize.match(/^([0-9]+)px ([0-9]+)px$/)[1],10);return n+parseInt(t.backgroundPositionX.match(/^calc[(]100% - ([0-9]+)px[)]$/)[1],10)}catch(e){return 28}}this.editMouseMove=function(e,t){if(!E(e))return;if(f.widgetCoordinates(e,t).x>e.offsetWidth-W(e)){e.classList&&e.classList.add("Wt-suggest-dropdown-hover");e.style.cursor="default"}else{e.classList&&e.classList.remove("Wt-suggest-dropdown-hover");e.style.cursor=""}};this.showAt=function(e,t){x();a=e.id;k=!0;void 0===t&&(t="");u.refilter(t)};this.editClick=function(e,t){if(!E(e))return;if(f.widgetCoordinates(e,t).x>e.offsetWidth-W(e))if(a===e.id&&w()){x();a=null}else u.showAt(e,"")};function M(e,t){for(e=t?e.nextSibling:e.previousSibling;e;e=t?e.nextSibling:e.previousSibling)if(f.hasTag(e,"LI")&&"none"!==e.style.display)return e;return null}this.editKeyDown=function(e,n){if(!E(e))return!0;if(a!==e.id)if(e.classList.contains("Wt-suggest-onedit")){a=e.id;k=!1}else{if(!e.classList.contains("Wt-suggest-dropdown")||40!==n.keyCode){a=null;return!0}a=e.id;k=!0}if(w()){const i=d?f.getElement(d):null;if(13===n.keyCode||9===n.keyCode){if(i){b(i);f.cancelEvent(n);setTimeout((function(){e.focus()}),0)}else x();return!1}if(40===n.keyCode||38===n.keyCode||34===n.keyCode||33===n.keyCode){if("KEYDOWN"===n.type.toUpperCase()){g=!0;f.cancelEvent(n,f.CancelDefaultAction)}if("KEYPRESS"===n.type.toUpperCase()&&!0===g){f.cancelEvent(n);return!1}let e=i;const l=40===n.keyCode||34===n.keyCode;if(e){const s=34===n.keyCode||33===n.keyCode?t.clientHeight/i.offsetHeight:1;for(let t=0;e&&t<s;++t){const t=M(e,l);if(!t&&c)break;e=t}}else{e=function(e){const n=t.childNodes;for(let t=e?n[0]:n[n.length-1];t;t=e?t.nextSibling:t.previousSibling)if(f.hasTag(t,"LI")&&"none"!==t.style.display)return t;return null}(l);H(e)}if(i){i.classList.remove("active");L()&&i.firstChild.classList.remove("active");d=null}if(e&&f.hasTag(e,"LI")){e.classList.add("active");L()&&e.firstChild.classList.add("active");H(e);d=e.id}return!1}}return 13!==n.keyCode&&9!==n.keyCode};this.filtered=function(e,t){h=e;y=t;u.refilter(v)};function H(e){const t=e.parentNode;e.offsetTop+e.offsetHeight>t.scrollTop+t.clientHeight?t.scrollTop=e.offsetTop+e.offsetHeight-t.clientHeight:e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop)}this.refilter=function(n){if(!a)return;let o=d?f.getElement(d):null;const g=f.getElement(a),C=i(g),E=t.childNodes,b=r&&null!==n?n:C(null);v=r?n:g.value;if(l>0||s){if(b.length<l&&!k){x();return}{const n=y?b:b.substring(0,Math.max(null!==h?h.length:0,l));if(n!==h&&n!==p){p=n;e.emit(t,"filter",n)}}}let S=null,W=null;const M=k&&0===b.length;for(let e=0,t=E.length;e<t;++e){const t=E[e];if(f.hasTag(t,"LI")){const n=t.firstChild;null!==t.orig&&void 0!==t.orig||(t.orig=n.firstChild.innerHTML);const i=C(t.orig),l=M||i.match;i.suggestion!==n.firstChild.innerHTML&&(n.firstChild.innerHTML=i.suggestion);if(l){""!==t.style.display&&(t.style.display="");null===S&&(S=t);e===this.defaultValue&&(W=t)}else"none"!==t.style.display&&(t.style.display="none");t.classList.remove("active");L()&&t.firstChild.classList.remove("active")}}if(null===S)x();else{if(!w()){!function(e){t.style.display="block";f.positionAtWidget(t.id,e.id,f.Vertical,!1,T,m)}(g);u.showPopup(g);o=null}if((c||W)&&(!o||"none"===o.style.display)){o=W||S;o.parentNode.scrollTop=0;d=o.id}if(o){o.classList.add("active");L()&&o.firstChild.classList.add("active");H(o)}}};this.editKeyUp=function(e,t){if(null!==a&&E(e)&&(w()||13!==t.keyCode&&9!==t.keyCode))if(27===t.keyCode||37===t.keyCode||39===t.keyCode)x();else if(40===t.keyCode||38===t.keyCode||34===t.keyCode||33===t.keyCode);else if(e.value!==v){a=e.id;u.refilter(e.value)}else{const e=d?f.getElement(d):null;e&&H(e)}};t.onclick=function(e){const t=e||window.event;let n=f.target(t);if(!f.hasTag(n,"UL")){for(;n&&!f.hasTag(n,"LI");)n=n.parentNode;n&&b(n)}};t.onscroll=function(){if(C){clearTimeout(C);const e=f.getElement(a);e&&e.focus()}};this.delayHide=function(e,n){C=setTimeout((function(){C=null;!t||null!==e&&a!==e.id||x()}),300)}}));WT_DECLARE_WT_MEMBER(2,JavaScriptConstructor,"WSuggestionPopupStdMatcher",(function(e,t,n,i,l,s,o){function r(e){const t=e.value,l=e.selectionStart?e.selectionStart:t.length;let s=n?t.lastIndexOf(n,l-1)+1:0;for(;s<l&&-1!==i.indexOf(t.charAt(s));)++s;return{start:s,end:l}}this.match=function(n){const i=r(n),o=n.value.substring(i.start,i.end);let c;if(0===s.length)if(0!==l.length){c="(^|(?:[";for(let e=0;e<l.length;++e){let t=l.charCodeAt(e).toString(16);for(;t.length<4;)t="0"+t;c+="\\u"+t}c+="]))"}else c="(^)";else c="("+s+")";c+="("+o.replace(new RegExp("([\\^\\\\\\][\\-.$*+?()|{}])","g"),"\\$1")+")";c=new RegExp(c,"gi");return function(n){if(!n)return o;let i=!1;if(o.length){const l=n.replace(c,"$1"+e+"$2"+t);if(l!==n){i=!0;n=l}}return{match:i,suggestion:n}}};this.replace=function(e,t,n){const i=r(e);let l=e.value.substring(0,i.start)+n+o;i.end<e.value.length&&(l+=e.value.substring(i.end,e.value.length));e.value=l;if(e.selectionStart){e.selectionStart=i.start+n.length+o.length;e.selectionEnd=e.selectionStart}}}));